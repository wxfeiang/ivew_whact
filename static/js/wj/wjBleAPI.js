"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_wjUtils=require("./wjUtils.js"),_wjUtils2=_interopRequireDefault(_wjUtils),_wjService=require("./wjService.js"),_wjService2=_interopRequireDefault(_wjService),_wjDataInteract=require("./wjDataInteract.js"),_wjDataInteract2=_interopRequireDefault(_wjDataInteract),_wjDataAnalysis=require("./wjDataAnalysis.js"),_wjDataAnalysis2=_interopRequireDefault(_wjDataAnalysis),_wjDataEncode=require("./wjDataEncode.js"),_wjDataEncode2=_interopRequireDefault(_wjDataEncode);function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var TAG_FUNCTION="function";function connectDevice(t){_wjService2.default.reallyScanConnect(function(e){(void 0===t?"undefined":_typeof(t))==TAG_FUNCTION&&t(e)})}function connectDevice2(e,t){var a={};_wjService2.default.reallyConnect(e,function(e){a=e,(void 0===t?"undefined":_typeof(t))==TAG_FUNCTION&&t(a)})}function disConnectDevice(t){var a={};_wjService2.default.reallyDisConnect(function(e){a=e,(void 0===t?"undefined":_typeof(t))==TAG_FUNCTION&&t(a)})}function getDeviceInfo(e,t){var a,n={},i="",o=_wjUtils2.default.getCMD_TYPE();0==o?i="810100"+e:1==o&&(i="A501"+e),a=_wjDataEncode2.default.encode(i),_wjDataInteract2.default._StartSendData(a.serviceData.dataEncode,function(e){n=0==e.serviceCode?(_wjUtils2.default.showLog("获取设备信息成功"),_wjDataAnalysis2.default.analysisDeviceInfo(e.serviceData.dataBuff)):e,(void 0===t?"undefined":_typeof(t))==TAG_FUNCTION&&t(n)})}function initIC(t){var e,a={},n="",i=_wjUtils2.default.getCMD_TYPE();0==i?n="80":1==i&&(n="A2"),e=_wjDataEncode2.default.encode(n),_wjDataInteract2.default._StartSendData(e.serviceData.dataEncode,function(e){a=0==e.serviceCode?_wjDataAnalysis2.default.analysisinitIC(e.serviceData.dataBuff):e,(void 0===t?"undefined":_typeof(t))==TAG_FUNCTION&&t(a)})}function selectDir(a,e,n){var i={};if(4==a.length&&"10"==e||"20"==e){var t="010700A4000002"+a,o=e,d="";1==_wjUtils2.default.getTRANSFER_TYPE()&&(t=_wjUtils2.default.TPDU2APDU(t));var f=_wjUtils2.default.getCMD_TYPE();0==f?d="82":1==f&&(d="A3"),this.transCommandPlain(t,o,d,function(e){if(0==e.serviceCode){var t=_wjDataAnalysis2.default._analysisIs9000(e.serviceData.dataBuff);i=e,0==t.serviceCode&&(_wjUtils2.default.showLog("进 "+a+" 目录成功"),i.serviceInfo="进"+a+"目录成功"),(void 0===n?"undefined":_typeof(n))==TAG_FUNCTION&&n(i)}else i=e,(void 0===n?"undefined":_typeof(n))==TAG_FUNCTION&&n(i)})}else i.serviceCode=-1,i.serviceInfo="参数长度有误",(void 0===n?"undefined":_typeof(n))==TAG_FUNCTION&&n(i)}function getCardInfo(t){var a={},e="010500B095002B0205805C000204",n="",i="";1==_wjUtils2.default.getTRANSFER_TYPE()&&(e=_wjUtils2.default.TPDU2APDU(e));var o=_wjUtils2.default.getCMD_TYPE();0==o?(n="10",i="82"):1==o&&(n="00",i="A3"),this.transCommandPlain(e,n,i,function(e){a=0==e.serviceCode?(_wjUtils2.default.showLog("获取卡片信息成功"),_wjDataAnalysis2.default.analysisCardInfo(e.serviceData.dataBuff)):e,(void 0===t?"undefined":_typeof(t))==TAG_FUNCTION&&t(a)})}function getRand(e,t){var a={},n="01050084000004",i=e,o="";1==_wjUtils2.default.getTRANSFER_TYPE()&&(n=_wjUtils2.default.TPDU2APDU(n));var d=_wjUtils2.default.getCMD_TYPE();0==d?o="82":1==d&&(o="A3"),this.transCommandPlain(n,i,o,function(e){a=0==e.serviceCode?(_wjUtils2.default.showLog("获取IC随机数成功"),_wjDataAnalysis2.default.analysisGetRand(e.serviceData.dataBuff)):e,(void 0===t?"undefined":_typeof(t))==TAG_FUNCTION&&t(a)})}function getObuSysInfo(t){var a={},e="010500B081001B",n="",i="";1==_wjUtils2.default.getTRANSFER_TYPE()&&(e=_wjUtils2.default.TPDU2APDU(e));var o=_wjUtils2.default.getCMD_TYPE();0==o?(n="20",i="82"):1==o&&(n="00",i="A0"),this.transCommandPlain(e,n,i,function(e){a=0==e.serviceCode?(_wjUtils2.default.showLog("获取系统信息成功"),_wjDataAnalysis2.default.analysisgetObuSysInfo(e.serviceData.dataBuff)):e,(void 0===t?"undefined":_typeof(t))==TAG_FUNCTION&&t(a)})}function writeObuIssue(e,a){var n={};if(null!=e&&20==e.length){var t="010A"+e,i="",o="";1==_wjUtils2.default.getTRANSFER_TYPE()&&(t=_wjUtils2.default.TPDU2APDU(t));var d=_wjUtils2.default.getCMD_TYPE();0==d?(i="20",o="82"):1==d&&(i="00",o="A0"),this.transCommandPlain(t,i,o,function(e){if(0==e.serviceCode){var t=_wjDataAnalysis2.default._analysisIs9000(e.serviceData.dataBuff);n=e,0==t.serviceCode&&(_wjUtils2.default.showLog("OBU激活成功"),n.serviceInfo="OBU激活成功"),(void 0===a?"undefined":_typeof(a))==TAG_FUNCTION&&a(n)}else n=e,(void 0===a?"undefined":_typeof(a))==TAG_FUNCTION&&a(n)})}else n.serviceCode=-1,n.serviceInfo="激活参数错误",(void 0===a?"undefined":_typeof(a))==TAG_FUNCTION&&a(n)}function transCommandPlain(e,t,a,n){var i={};if("10"==t||"20"==t||"30"==t||"00"==t){var o;o=_wjDataEncode2.default.encode(e,t,a),_wjDataInteract2.default._StartSendData(o.serviceData.dataEncode,function(e){i=(0==e.serviceCode&&_wjUtils2.default.showLog("APDU透传指令成功"),e),(void 0===n?"undefined":_typeof(n))==TAG_FUNCTION&&n(i)})}else i.serviceCode=-1,i.serviceInfo="command参数错误！",(void 0===n?"undefined":_typeof(n))==TAG_FUNCTION&&n(i)}module.exports={connectDevice:connectDevice,connectDevice2:connectDevice2,disConnectDevice:disConnectDevice,getDeviceInfo:getDeviceInfo,getCardInfo:getCardInfo,getObuSysInfo:getObuSysInfo,writeObuIssue:writeObuIssue,transCommandPlain:transCommandPlain,selectDir:selectDir,getRand:getRand,initIC:initIC};